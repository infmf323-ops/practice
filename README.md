# Анализ занятости столов в кафе

Веб-приложение для анализа загрузки столов по фотографии зала: загрузка изображения → детекция столов и людей (YOLO) → статистика занятости и история запросов.

## Что делает

- Загрузка фото зала (JPG, PNG и др.)
- Детекция объектов: столы (`dining table`) и люди (`person`) через YOLOv8
- Подсчёт занятых столов по пересечению боксов стола и человека (IoU > 0.1)
- Выдача статистики: всего столов, занято, свободно, % загрузки
- Сохранение истории анализов в `data/history.json`

## Стек

- **Backend:** Python, FastAPI, Ultralytics (YOLOv8), OpenCV, NumPy
- **Frontend:** один HTML-файл (CSS + JS), без сборки

## Установка

1. Клонируйте репозиторий или скопируйте файлы проекта.

2. Создайте виртуальное окружение (рекомендуется):

   ```bash
   python -m venv venv
   venv\Scripts\activate
   ```

3. Установите зависимости:

   ```bash
   pip install -r requirements.txt
   ```

4. При первом запуске Ultralytics сам скачает модель `yolov8n.pt` (если файла ещё нет).

## Запуск

Из корня проекта (`pract`):

```bash
uvicorn backend_main:app --reload --host 127.0.0.1 --port 8000
```

Откройте в браузере: **http://127.0.0.1:8000/**

## Структура проекта

```
pract/
├── backend_main.py      # FastAPI-сервер, YOLO-анализ, история
├── frontend_index.html  # Веб-интерфейс (раздаётся по GET /)
├── requirements.txt     # Зависимости Python
├── README.md
├── .gitignore
└── data/                # Создаётся при первом запуске
    └── history.json     # История запросов
```

## API

| Метод | Путь      | Описание |
|-------|------------|----------|
| GET   | `/`        | Главная страница (frontend_index.html) |
| POST  | `/analyze` | Загрузка изображения (form-data, поле `file`), ответ — JSON с полями `total_tables`, `occupied_tables`, `free_tables`, `occupancy_rate` |
| GET   | `/history` | Список записей истории (JSON) |
| GET   | `/api/status` | Статус бэкенда |

## История

- Хранится в **`data/history.json`**.
- Каждый успешный запрос к `/analyze` добавляет запись с датой, количеством столов и процентом загрузки.
- На фронте кнопка «Показать историю» запрашивает GET `/history` и отображает таблицу.

## Лицензия

Учебный проект.
